<tool id="SRS_global_indices" name="Compute biodiversity indices" version="@VERSION@" profile = "20.01">
    <description>from remote sensing data</description>
    <macros>
        <import>macro.xml</import>
    </macros>
    <requirements>
        <requirement type="package" version="3.5_15">r-raster</requirement>
        <requirement type="package" version="1.5_29">r-rgdal</requirement>
        <requirement type="package" version="1.4_7">r-sp</requirement>
        <requirement type="package" version="0.2_5.2">r-rasterdiv</requirement>
        <requirement type="package" version="3.3.6">r-ggplot2</requirement> 
    </requirements>
    <command detect_errors="exit_code"><![CDATA[ 
        cp '$input_raster' '${input_raster.element_identifier}' &&
        cp '$input_header' '${input_header.element_identifier}' &&
        Rscript
            '$__tool_directory__/Biodiv_indices_G.r'
            '$input_raster.element_identifier'
            '$input_header.element_identifier'
            '$alpha'
            '$output_indices'
            '$plots_png'
        ]]>
    </command>
    <inputs>
        <param name="input_raster" type="data" format="bil" label="Input raster"/>
        <param name="input_header" type="data" format="hdr" label="Input raster header"/>
        <param name="alpha" type="text" label="Write a number of the value of alpha you want to calculate Renyi, Prao and Hill indicators (between 0 and 5)"/>
    </inputs>
    <outputs>
        <data name="output_indices" from_work_dir="BiodivIndex.tabular" format="tabular" label="Biodiversity indices">
        </data>
        <collection type="list" name="plots_png">
            <discover_datasets pattern="(?P&lt;designation&gt;.+)\.png" visible="false" format="png"/>
        </collection>
    </outputs>
    <tests>
        <test>
            <param name="input_raster" value="S2A_Subset"/>
            <param name="input_header" value="S2A_Subset.hdr"/>
            <param name="alpha" value="1"/>
            <output name="output_indices" value="BiodivIndex.tabular"/>
            <output_collection name="plots_png" type="list" count="7"/>
        </test>
    </tests>
    <help><![CDATA[
=========================================================================
Computes biodiversity spectral indices from satellite remote sensing data 
=========================================================================


**What it does**

This tool aims to provide functions to apply Information Theory based diversity indexes on RasterLayer or numerical matrices, such as Shannon's entropy or Cumulative Residual Entropy (CRE).


**Input description**
It expects an image file as input, with a specific data format. ENVI HDR image with BIL interleave required.
The image is an ENVI raster including :

- A binary file (which has no extension here).

- A header file (with .hdr extension).

The header file is a text file including all necessary metadata which can be read with a text editor. It includes image dimensions, projection, and the name and central wavelength for each spectral band.

In order to get such input we advise to use the tool preprocessing sentinel 2 data. 

+--------------+----------+---------------+
|      BIL     | ENVI HDR |  Number alpha |
+==============+==========+===============+
| raster stack | Metadata |       1       |
+--------------+----------+---------------+
|      ...     |    ...   |      ...      |
+--------------+----------+---------------+

**Output**

- 1 tabular with longitude and latitude columns and the columns for each indices.

- 7 png graph one for each indices.

    ]]>    </help>
        <expand macro="SRS_rasterdivref"/>
</tool>
